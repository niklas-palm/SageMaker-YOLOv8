AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'Three different SageMaker endpoint types for demo purposes.

  '
Parameters:
  MyCustomImage:
    Description: ARN of custom image to use
    Type: String
  MyExecutionRole:
    Description: ARN of execution role for the endpoint
    Type: String
  ModelS3Uri:
    Description: S3 uri of Gzipped model archive.
    Type: String
  EndpointInstanceType:
    Description: What instance type to use for the endpoint
    Type: String
    Default: ml.g5.xlarge
Resources:
  SageMakerModel:
    Type: AWS::SageMaker::Model
    Properties:
      ModelName:
        Fn::Sub: YOLOv8-${AWS::StackName}
      ExecutionRoleArn:
        Ref: MyExecutionRole
      PrimaryContainer:
        Image:
          Ref: MyCustomImage
        ModelDataSource:
          S3DataSource:
            S3Uri:
              Ref: ModelS3Uri
            S3DataType: S3Prefix
            CompressionType: Gzip
  SageMakerRealtimeEndpointConfig:
    Type: AWS::SageMaker::EndpointConfig
    Properties:
      ProductionVariants:
      - InitialInstanceCount: 1
        InitialVariantWeight: 1.0
        InstanceType:
          Ref: EndpointInstanceType
        ModelName:
          Fn::GetAtt:
          - SageMakerModel
          - ModelName
        VariantName: AllTrafficVariant
  MyYoloV8Endpoint:
    Type: AWS::SageMaker::Endpoint
    Properties:
      EndpointConfigName:
        Fn::GetAtt:
        - SageMakerRealtimeEndpointConfig
        - EndpointConfigName
      Tags:
      - Key: project
        Value: demo
Outputs:
  EndpointName:
    Value:
      Fn::GetAtt:
      - MyYoloV8Endpoint
      - EndpointName
